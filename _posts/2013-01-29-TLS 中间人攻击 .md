---
layout: post
title: TLS 中间人攻击
tags: 技术
comment: true
published: true
description:
---
TLS 中间人攻击
从前有一枚高富帅叫包柏，女友是白富美女神艾丽丝，却苦于天各一方，只能求书信往来以解相思之苦。奈何时局动荡、人心不古，觊觎女神者比比皆是。书信若为明文，定要被那中转信件的屌丝马勒睿拆看，而后从中作祟，行不轨之事。

http链接，现在运营商直接给你弹屏广告就是截断你的通信，硬塞进来的。

于是包柏与艾丽丝商定，从今而后，艾丽丝给包柏的书信均以密文誊写，再附以特制封签，包柏收到密信后可凭此封签在一公证可信之处验明此信是否确为艾丽丝所发。

https链接，约定密钥，并约定证书，解密码时去证书服务器请求验证下

商定完毕，二人书信往来再非明文。马勒睿拆看无果，甚是捉急，情急之下心生一计：既然无法看到艾丽丝的密信内容，不如索性截下来信，自行伪造一封转交包柏，再设法从他那套取消息？


打定主意，马勒睿翻看了一下手中艾丽丝给包柏的一封密信：
封签：ecaa5d137be9468d98379ada45919d80
从哪来：艾丽丝
打哪去：包柏

[正文已加密]
马勒睿旋即扣下了这封信，伪造了另外一封交给包柏：
封签：718fe14088974488b821f8c9d8f14849
从哪来：艾丽丝
打哪去：包柏

亲爱的，上次你给我说你的银行卡帐号密码是多少来着？我一下忘记了。急用！

附：回信记得用密码「此地无银三百两」加密哟！

包柏收到篡改的信件后，看到艾丽丝急于盼复，未经细察，便回信告知了银行卡帐号密码。于是就悲剧了……

这就是最基础的中间人攻击。包柏如果谨慎一点，每次收到密信时都去那公证可信之处验证一下封签，确认信件是由艾丽丝所发，上面的悲剧就不会发生。

证书就是服务器的公钥、服务器的各种信息（比如“我是http://github.com", 我的这个公钥最多能用到xxxx年x月x日），加上一个可信的第三方对公钥和这些信息的签名。通过靠谱的服务器机关认证，TLS中间人就没必要骗取了。

不过道高一尺、魔高一丈，马勒睿若能控制那公证可信之处，待包柏去验证时就可以做手脚，让包柏误以为伪造密信确为艾丽丝所发，于是继续悲剧……这种手法叫做伪造证书。

SSL/TLS 依赖的 PKI 信任链有设计漏洞，在主权国家参与的中间人攻击中 SSL/TLS 不能有效保护个人通信安全，普通人几乎无法防范。因为老大哥可以直接控制证书提供服务商。